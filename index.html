<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="theme-color" content="#FF7A00">
<title>å¹¸ç¦é­”æ³•å¸«</title>
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icons/icon-192.png">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<style>
:root{
  --o:#FF7A00;
  --y:#FFD54F;
  --p:#FF5FA2;
  --b:#4DB6FF;
  --g:#34D399;
  --ink:#3A1C00;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif;
  background: radial-gradient(1200px 700px at 10% 10%, #FFF0C2 0%, #FFE9D6 35%, #FFD6E7 65%, #FFB36C 100%);
  color:var(--ink);
}
header{
  position:sticky; top:0; z-index:5;
  padding:16px 14px;
  text-align:center;
  font-weight:1000;
  font-size:20px;
  background: linear-gradient(90deg, var(--o), #FF9F1C, var(--p));
  color:#fff;
  box-shadow: 0 10px 18px rgba(0,0,0,.18);
}
main{padding:14px; padding-bottom:120px}
.card{
  background:rgba(255,255,255,.92);
  border-radius:22px;
  padding:16px;
  margin-bottom:14px;
  box-shadow:0 10px 22px rgba(0,0,0,.14);
  border: 2px solid rgba(255,255,255,.55);
  backdrop-filter: blur(6px);
}
h2{margin:0 0 10px; font-size:16px}
.small{font-size:13px; opacity:.9; margin-top:6px; line-height:1.5}
.kv{
  display:flex; justify-content:space-around; gap:10px;
  font-weight:1000; font-size:18px;
}
.badge{
  display:inline-block;
  padding:6px 10px;
  border-radius:999px;
  background:#FFF3E0;
  font-weight:1000;
}
.row{display:flex; gap:10px; align-items:stretch}
.row > *{flex:1}
.btn{
  width:100%;
  padding:16px 14px;
  border:0;
  border-radius:16px;
  font-weight:1000;
  font-size:16px;
  color:#fff;
  cursor:pointer;
  box-shadow: 0 10px 18px rgba(0,0,0,.12);
}
.btn:active{transform:scale(.98)}
.btn.o{background:linear-gradient(180deg,#FF8A2B,var(--o))}
.btn.b{background:linear-gradient(180deg,#6EC6FF,var(--b))}
.btn.p{background:linear-gradient(180deg,#FF86C8,var(--p))}
.btn.g{background:linear-gradient(180deg,#6EE7B7,var(--g))}
.pill{
  width:100%;
  padding:12px 12px;
  border-radius:14px;
  border:2px dashed rgba(255,122,0,.55);
  font-weight:900;
  background:#fffaf0;
}
.box{
  margin-top:10px;
  background:#FFF3E0;
  padding:12px;
  border-radius:14px;
  font-weight:1000;
  line-height:1.45;
}
.tabs{display:flex; gap:10px}
.tab{
  flex:1;
  padding:12px;
  border-radius:14px;
  border:0;
  font-weight:1000;
  background:#fff;
  color:var(--o);
  cursor:pointer;
}
.tab.active{
  background: linear-gradient(90deg,var(--p),#FFB36C);
  color:#fff;
}
.list{margin-top:10px}
.item{
  display:flex; gap:8px; align-items:center;
  background:#FFF3E0;
  padding:10px 10px;
  border-radius:14px;
  margin-bottom:8px;
}
.item .t{flex:1; font-weight:900}
.item button{
  border:0;
  background:var(--ink);
  color:#fff;
  font-weight:1000;
  border-radius:12px;
  padding:8px 10px;
  cursor:pointer;
}
.links a{
  display:block;
  text-decoration:none;
  text-align:center;
  padding:14px;
  border-radius:16px;
  background: linear-gradient(180deg, var(--y), #FFE9A6);
  font-weight:1000;
  color:var(--ink);
  margin-top:10px;
}
.footerBar{
  position:fixed; left:0; right:0; bottom:0;
  padding:10px 12px;
  background: rgba(255,255,255,.9);
  border-top: 1px solid rgba(0,0,0,.08);
  backdrop-filter: blur(8px);
  display:flex; gap:10px;
}
.footerBar button{
  flex:1; padding:12px;
  border-radius:14px; border:0;
  font-weight:1000; cursor:pointer;
  background:#FFF3E0; color:var(--ink);
}
#toast{
  position:fixed;
  bottom:86px; left:50%;
  transform:translateX(-50%);
  background:var(--ink);
  color:#fff;
  padding:12px 16px;
  border-radius:999px;
  font-weight:1000;
  display:none;
  max-width: calc(100vw - 32px);
  text-align:center;
}
</style>
</head>
<body>
<header>å¹¸ç¦é­”æ³•å¸«</header>

<main>
  <section class="card">
    <h2>æ¨¡å¼</h2>
    <div class="tabs">
      <button id="modeParent" class="tab active">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ è¦ªå­</button>
      <button id="modeSibling" class="tab">ğŸ‘§ğŸ§’ å…„å¼Ÿå§Šå¦¹</button>
    </div>
    <div class="small">ä¸ç”¨è¬›é“ç†ï¼šæŒ‰ä¸€ä¸‹ï¼Œå°±é–‹å§‹ç©ã€‚</div>
  </section>

  <section class="card">
    <h2>â­ é»æ•¸</h2>
    <div class="kv">
      <div><span id="aName" class="badge">å¤§äºº</span>ï¼š<span id="aScore">0</span></div>
      <div><span id="bName" class="badge">å¯¶è²</span>ï¼š<span id="bScore">0</span></div>
    </div>
  </section>

  <section class="card">
    <h2>ğŸª„ å¹¸ç¦é­”æ³•å¸«</h2>
    <div class="row">
      <button id="drawForB" class="btn o">æŠ½çµ¦ <span id="bName2">å¯¶è²</span></button>
      <button id="drawForA" class="btn b">æŠ½çµ¦ <span id="aName2">å¤§äºº</span></button>
    </div>
    <div id="magicResult" class="box">é»ä¸€é¡†æŠ½ç±¤ï¼šæŠ½åˆ°çš„æ˜¯ã€Œè®“å°æ–¹è‡ªå‹•å®Œæˆã€çš„äº‹ã€‚</div>

    <div class="row" style="margin-top:10px">
      <button id="bDid" class="btn g"><span id="bName3">å¯¶è²</span>è‡ªå‹•å®Œæˆ âœ <span id="aName3">å¤§äºº</span> +1</button>
      <button id="aDid" class="btn p"><span id="aName4">å¤§äºº</span>è‡ªå‹•å®Œæˆ âœ <span id="bName4">å¯¶è²</span> +1</button>
    </div>
    <div class="small">æŠ½åˆ°ä¸æƒ³åšï¼Ÿæ²’é—œä¿‚ï¼Œç¬‘ä¸€ç¬‘å†æŠ½ä¸€æ¬¡ã€‚</div>
  </section>

  <section class="card">
    <h2>ğŸ§² å¹¸ç¦è²¼å¿ƒç£éµ</h2>
    <input id="shareInput" class="pill" placeholder="ï¼ˆå¯é¸ï¼‰å¯«ä¸€å¥ï¼šä»Šå¤©æŠŠå¿«æ¨‚å¸éä¾†çš„ä¸€ä»¶äº‹" />
    <div class="row" style="margin-top:10px">
      <button id="shareB" class="btn o"><span id="bName5">å¯¶è²</span>åˆ†äº« âœ <span id="aName5">å¤§äºº</span> +1</button>
      <button id="shareA" class="btn b"><span id="aName6">å¤§äºº</span>åˆ†äº« âœ <span id="bName6">å¯¶è²</span> +1</button>
    </div>
    <div id="lastShare" class="box">è¦ªå­äº’ç›¸åˆ†äº«ä¸€ä»¶å°±å¥½ï¼šä¸€ä»¶ä¸€é»ã€‚</div>
  </section>

  <section class="card">
    <h2>ğŸ“‹ é¡˜æœ›æ± ï¼ˆåˆ†é–‹ã€ä¸€èµ·è¨è«–ï¼‰</h2>
    <div class="small">
      <b><span id="aName7">å¤§äºº</span>é¡˜æœ›æ± </b>ï¼šå¸Œæœ› <span id="bName7">å¯¶è²</span>ã€Œè‡ªå‹•ã€åšåˆ°<br>
      <b><span id="bName8">å¯¶è²</span>é¡˜æœ›æ± </b>ï¼šå¸Œæœ› <span id="aName8">å¤§äºº</span>ã€Œè‡ªå‹•ã€åšåˆ°
    </div>

    <input id="wishInput" class="pill" placeholder="è¼¸å…¥ä¸€å€‹ã€è‡ªå‹•ã€é¡˜æœ›ï¼ˆä¾‹å¦‚ï¼šè‡ªå‹•åƒé’èœ / æº«æŸ”èªªè©±ï¼‰" />
    <div class="row" style="margin-top:10px">
      <button id="addToA" class="btn o">åŠ å…¥ <span id="aName9">å¤§äºº</span>é¡˜æœ›æ± </button>
      <button id="addToB" class="btn b">åŠ å…¥ <span id="bName9">å¯¶è²</span>é¡˜æœ›æ± </button>
    </div>

    <div class="row" style="margin-top:12px">
      <div>
        <div class="badge">ğŸ§º <span id="aName10">å¤§äºº</span>é¡˜æœ›æ± </div>
        <div id="listA" class="list"></div>
      </div>
      <div>
        <div class="badge">ğŸˆ <span id="bName10">å¯¶è²</span>é¡˜æœ›æ± </div>
        <div id="listB" class="list"></div>
      </div>
    </div>
  </section>

  <section class="card links">
    <a href="https://forms.gle/vYMsw6bgiJYn32Gk9" target="_blank" rel="noopener">ğŸ“ å›é¥‹è¡¨å–®</a>
    <a href="https://angel0973180707.github.io/angel-happy-paw/" target="_blank" rel="noopener">ğŸ  ä¸€éµå›æ¦‚å¿µé¤¨</a>
    <a href="https://www.youtube.com/@%E5%A4%A9%E4%BD%BF%E7%AC%91%E9%95%B7" target="_blank" rel="noopener">â–¶ï¸ å¤©ä½¿ç¬‘é•·é »é“</a>
  </section>
</main>

<div id="toast"></div>

<div class="footerBar">
  <button id="resetToday">é‡è¨­é»æ•¸</button>
  <button id="clearWishes">æ¸…ç©ºé¡˜æœ›æ± </button>
</div>

<script>
'use strict';
(function(){
  const $ = (id) => document.getElementById(id);

  const DEFAULT_WISHES_A = ["è‡ªå‹•åƒä¸€å£é’èœ","è‡ªå‹•æ”¶ä¸€æ¨£æ±è¥¿å›åŸä½","è‡ªå‹•åˆ†äº«ä¸€ä»¶ä»Šå¤©çš„å¿ƒäº‹","è‡ªå‹•è¬›ä¸€å€‹ç¬‘è©±/å°æ•…äº‹","è‡ªå‹•èªªä¸€å¥ç”œå¿ƒè©±"];
  const DEFAULT_WISHES_B = ["è‡ªå‹•è¬›è©±æº«æŸ”ä¸€é»","è‡ªå‹•è½æˆ‘èªªå®Œ","è‡ªå‹•çµ¦æˆ‘ä¸€å€‹æŠ±æŠ±","è‡ªå‹•è¬›ä¸€å€‹ç¡å‰æ•…äº‹","è‡ªå‹•é™ªæˆ‘ç¬‘ä¸€ä¸‹"];

  const KEY = "happyMagic_v7";

  let s;
  try{
    s = JSON.parse(localStorage.getItem(KEY)) || {mode:"parent",scoreA:0,scoreB:0,wishesA:[],wishesB:[],lastMagic:"",lastShare:""};
  }catch(e){
    s = {mode:"parent",scoreA:0,scoreB:0,wishesA:[],wishesB:[],lastMagic:"",lastShare:""};
  }
  function save(){ localStorage.setItem(KEY, JSON.stringify(s)); }

  function toast(msg){
    const t = $("toast");
    t.textContent = msg;
    t.style.display = "block";
    clearTimeout(toast._tm);
    toast._tm = setTimeout(()=> t.style.display="none", 1300);
  }

  function names(){ return s.mode==="sibling" ? {A:"å“¥å“¥",B:"å¦¹å¦¹"} : {A:"å¤§äºº",B:"å¯¶è²"}; }
  function poolA(){ return (s.wishesA && s.wishesA.length) ? s.wishesA : DEFAULT_WISHES_A; }
  function poolB(){ return (s.wishesB && s.wishesB.length) ? s.wishesB : DEFAULT_WISHES_B; }
  function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  function setLabels(){
    const n = names();
    const pairs = [
      ["aName",n.A],["bName",n.B],
      ["aName2",n.A],["bName2",n.B],
      ["aName3",n.A],["bName3",n.B],
      ["aName4",n.A],["bName4",n.B],
      ["aName5",n.A],["bName5",n.B],
      ["aName6",n.A],["bName6",n.B],
      ["aName7",n.A],["bName7",n.B],
      ["aName8",n.A],["bName8",n.B],
      ["aName9",n.A],["bName9",n.B],
      ["aName10",n.A],["bName10",n.B],
    ];
    pairs.forEach(([id,val])=>{ const el=$(id); if(el) el.textContent = val; });

    $("aScore").textContent = String(s.scoreA||0);
    $("bScore").textContent = String(s.scoreB||0);
    $("magicResult").textContent = s.lastMagic || "é»ä¸€é¡†æŠ½ç±¤ï¼šæŠ½åˆ°çš„æ˜¯ã€Œè®“å°æ–¹è‡ªå‹•å®Œæˆã€çš„äº‹ã€‚";
    $("lastShare").textContent = s.lastShare || "è¦ªå­äº’ç›¸åˆ†äº«ä¸€ä»¶å°±å¥½ï¼šä¸€ä»¶ä¸€é»ã€‚";

    $("modeParent").classList.toggle("active", s.mode==="parent");
    $("modeSibling").classList.toggle("active", s.mode==="sibling");
  }

  function renderLists(){
    const listA = $("listA");
    const listB = $("listB");

    const showA = (s.wishesA && s.wishesA.length) ? s.wishesA : DEFAULT_WISHES_A;
    const showB = (s.wishesB && s.wishesB.length) ? s.wishesB : DEFAULT_WISHES_B;

    listA.innerHTML = showA.map((w, idx)=>{
      const deletable = (s.wishesA && s.wishesA.length) ? idx < s.wishesA.length : false;
      return `<div class="item"><div class="t">${w}</div>${deletable?`<button data-del="A" data-i="${idx}">åˆª</button>`:""}</div>`;
    }).join("");

    listB.innerHTML = showB.map((w, idx)=>{
      const deletable = (s.wishesB && s.wishesB.length) ? idx < s.wishesB.length : false;
      return `<div class="item"><div class="t">${w}</div>${deletable?`<button data-del="B" data-i="${idx}">åˆª</button>`:""}</div>`;
    }).join("");
  }

  function bindDelete(){
    $("listA").onclick = (e)=>{
      const btn = e.target.closest("button[data-del]");
      if(!btn) return;
      const i = Number(btn.getAttribute("data-i"));
      s.wishesA.splice(i,1);
      save(); render(); toast("å·²åˆªé™¤ï¼ˆå¤§äººé¡˜æœ›æ± ï¼‰");
    };
    $("listB").onclick = (e)=>{
      const btn = e.target.closest("button[data-del]");
      if(!btn) return;
      const i = Number(btn.getAttribute("data-i"));
      s.wishesB.splice(i,1);
      save(); render(); toast("å·²åˆªé™¤ï¼ˆå¯¶è²é¡˜æœ›æ± ï¼‰");
    };
  }

  function render(){ setLabels(); renderLists(); }

  $("modeParent").onclick = ()=>{ s.mode="parent"; save(); render(); toast("åˆ‡åˆ°è¦ªå­æ¨¡å¼"); };
  $("modeSibling").onclick = ()=>{ s.mode="sibling"; save(); render(); toast("åˆ‡åˆ°å…„å¼Ÿå§Šå¦¹æ¨¡å¼"); };

  $("drawForB").onclick = ()=>{
    const n = names();
    s.lastMagic = `çµ¦${n.B}ï¼š${pick(poolA())}`;
    save(); render(); toast("æŠ½å¥½äº† âœ¨");
  };
  $("drawForA").onclick = ()=>{
    const n = names();
    s.lastMagic = `çµ¦${n.A}ï¼š${pick(poolB())}`;
    save(); render(); toast("æŠ½å¥½äº† âœ¨");
  };

  $("bDid").onclick = ()=>{
    const n = names();
    s.scoreA = (s.scoreA||0) + 1;
    save(); render(); toast(`${n.A} +1`);
  };
  $("aDid").onclick = ()=>{
    const n = names();
    s.scoreB = (s.scoreB||0) + 1;
    save(); render(); toast(`${n.B} +1`);
  };

  $("shareB").onclick = ()=>{
    const n = names();
    const note = $("shareInput").value.trim();
    s.lastShare = note ? `âœ¨ ${n.B}åˆ†äº«ï¼š${note}` : `âœ¨ ${n.B}åˆ†äº«äº†ä¸€ä»¶å¿«æ¨‚`;
    $("shareInput").value = "";
    s.scoreA = (s.scoreA||0) + 1;
    save(); render(); toast(`${n.A} +1`);
  };
  $("shareA").onclick = ()=>{
    const n = names();
    const note = $("shareInput").value.trim();
    s.lastShare = note ? `âœ¨ ${n.A}åˆ†äº«ï¼š${note}` : `âœ¨ ${n.A}åˆ†äº«äº†ä¸€ä»¶å¿«æ¨‚`;
    $("shareInput").value = "";
    s.scoreB = (s.scoreB||0) + 1;
    save(); render(); toast(`${n.B} +1`);
  };

  function addWish(which){
    const n = names();
    const v = $("wishInput").value.trim();
    if(!v) return toast("å…ˆè¼¸å…¥ä¸€å€‹é¡˜æœ›");
    if(which==="A"){
      s.wishesA = s.wishesA || [];
      s.wishesA.unshift(v);
      toast(`åŠ å…¥${n.A}é¡˜æœ›æ± `);
    }else{
      s.wishesB = s.wishesB || [];
      s.wishesB.unshift(v);
      toast(`åŠ å…¥${n.B}é¡˜æœ›æ± `);
    }
    $("wishInput").value = "";
    save(); render();
  }
  $("addToA").onclick = ()=> addWish("A");
  $("addToB").onclick = ()=> addWish("B");

  $("resetToday").onclick = ()=>{
    s.scoreA = 0; s.scoreB = 0;
    s.lastMagic = ""; s.lastShare = "";
    save(); render(); toast("é»æ•¸å·²é‡è¨­");
  };
  $("clearWishes").onclick = ()=>{
    s.wishesA = []; s.wishesB = [];
    save(); render(); toast("é¡˜æœ›æ± å·²æ¸…ç©º");
  };

  bindDelete();
  render();

  window.addEventListener("error", ()=>{
    if(window.__hm_err) return;
    window.__hm_err = true;
    toast("âš ï¸ å°éŒ¯èª¤ï¼Œè«‹é‡æ–°æ•´ç†");
  });
})();
</script>
</body>
</html>
